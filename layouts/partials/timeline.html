{{ $decades := $.Site.Data.timeline.decades }}
{{ $imageWidth := printf "%s%s" (strings.TrimSuffix "px" (string $.Site.Data.timeline.imageSize.width)) "x" }}
{{ $quotes := $.Site.GetPage (path.Join "/timeline") }}

<div class="timeline ">
  {{ range $decades }}
    {{ if (where $quotes.Pages ".Params.Decade" "==" .) }}
      {{ $decade := .}}
			{{$towerClass := "timeline__tower--none"}}
			{{ if eq (int $decade ) 1970}}
				{{$towerClass = "timeline__tower--top"}}
			{{ end }}
			{{ if gt (int $decade ) 1970}}
				{{$towerClass = "timeline__tower"}}
			{{ end }}
			{{ if eq (int $decade ) 2020}}
				{{$towerClass = "timeline__tower--bottom"}}
			{{ end }}
			<div class="{{$towerClass}}">
				<div class="timeline__line">
					<div class="timeline__decade">
							<h2 id={{ string $decade }} class="timeline__decade__title">{{ $decade }}</h2>
              <div class="timeline__entries">
                {{ range $i, $val := (where ($quotes.Pages.ByParam "Year") ".Params.Decade" "==" $decade)}}
                  {{ $quote := .}}
                  {{ $withoutImage := eq (len (string (.Resources.GetMatch $quote.Params.Image_path))) 0}}
                  {{ $withQuote := gt (len .Content) 0}}
                  <div class="timeline__entry {{cond (and (ne $withoutImage true) $withQuote) "timeline__entry--outlined" ""}}">
                    {{ with .Resources.GetMatch $quote.Params.Image_path }}
                      {{ $originalImagePath := . }}
                      {{ with .Resize $imageWidth }}
                        <div class="timeline-image timeline-image__container {{cond (eq $withQuote false) "timeline-image__image-only" ""}}">
                          {{ partial "magnifying-glass.svg" }}
                          <img 
                            class="timeline-image__image" 
                            src={{ .RelPermalink }} 
                            alt={{ $quote.Params.image_alt }} 
                            title={{ $originalImagePath }}
                          ></img>
                        </div>
                      {{ end }}
                    {{ end }}
                    {{ if .Content }}
                      <div class="timeline__quote {{cond $withoutImage "timeline__quote--outlined" ""}}">
                        {{ .Content }}
                        {{ with $quote.Params.source}}
                          <p class="timeline__quote-source">{{ . }}</p>
                        {{ end }}
                        {{ with $quote.Params.category}}
                          <div class="timeline__type">
                            {{ replace . "_" " " }}
                          </div>
                        {{ end }}
                      </div>
                    {{ end }}
                  </div>
                {{ end }}
              </div>
					</div>
				</div>
			</div>
    {{ end }}
  {{ end }}
  <div class="lightbox"></div>
</div>
